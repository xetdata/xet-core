#!/bin/sh

# Find all subdirectories containing a Cargo.toml file
find . -type f -name 'Cargo.toml' -execdir sh -c '
  # Run cargo fmt
  if ! cargo fmt > /dev/null 2>&1; then
    echo "cargo fmt failed in $(pwd)" >&2
  fi

  # Run cargo generate-lockfile
  if ! cargo generate-lockfile > /dev/null 2>&1; then
    echo "cargo generate-lockfile failed in $(pwd)" >&2
  fi
' \;

# Always return true to allow the commit to proceed
exit 0

